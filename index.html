<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ö–æ—Å–º–∏—á–µ—Å–∫–∏–π –ø—Ä–æ—Ñ–∏–ª—å</title>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-database-compat.js"></script>
    <style>
        /* –í—Å–µ —Å—Ç–∏–ª–∏ –æ—Å—Ç–∞—é—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π */
        :root {
            --primary-color: #007bff;
            --gold-color: #ffdd57;
            --text-color: #fff;
            --bg-color: #0a0a1a;
        }
        
        body {
            font-family: 'Arial', sans-serif;
            margin: 0;
            overflow: hidden;
            color: var(--text-color);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: var(--bg-color);
        }

        /* ... (–≤—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ –æ—Å—Ç–∞—é—Ç—Å—è —Ç–æ—á–Ω–æ —Ç–∞–∫–∏–º–∏ –∂–µ) ... */
    </style>
</head>
<body>
    <!-- –≠–∫—Ä–∞–Ω –≤—Ö–æ–¥–∞ -->
    <div class="login-screen" id="loginScreen">
        <h1 class="login-title">–ö–æ—Å–º–∏—á–µ—Å–∫–∏–π –ø—Ä–æ—Ñ–∏–ª—å</h1>
        <button class="login-btn" id="loginBtn">üöÄ –í–æ–π—Ç–∏ —á–µ—Ä–µ–∑ Telegram</button>
    </div>

    <!-- –ò–∫–æ–Ω–∫–∞ –º–µ–Ω—é -->
    <div class="menu-icon" onclick="toggleMenu()">‚ò∞</div>

    <!-- –í—ã–ø–∞–¥–∞—é—â–µ–µ –º–µ–Ω—é -->
    <div class="menu" id="menu">
        <button onclick="window.location.href='index.html'"><span>üéÆ</span> –ò–≥—Ä—ã</button>
        <button onclick="window.location.href='profile.html'"><span>üë§</span> –ü—Ä–æ—Ñ–∏–ª—å</button>
        <button onclick="openWithdraw()"><span>üí≥</span> –í—ã–≤–æ–¥</button>
        <button onclick="openDeposit()"><span>üí∞</span> –î–µ–ø–æ–∑–∏—Ç</button>
        <button onclick="openSupport()"><span>üõü</span> –ü–æ–¥–¥–µ—Ä–∂–∫–∞</button>
        <button onclick="openHistory()"><span>üìä</span> –ò—Å—Ç–æ—Ä–∏—è</button>
    </div>

    <!-- –ó–≤–µ–∑–¥–Ω—ã–π —Ñ–æ–Ω -->
    <div class="stars" id="stars-container"></div>

    <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –ø—Ä–æ—Ñ–∏–ª—è -->
    <div class="profile-container" id="profileContainer">
        <div class="profile-header">
            <h1>–ö–æ—Å–º–∏—á–µ—Å–∫–∏–π –ø—Ä–æ—Ñ–∏–ª—å</h1>
        </div>
        <div class="profile-content">
            <img id="avatar" src="" alt="–ê–≤–∞—Ç–∞—Ä" class="avatar" loading="eager">
            <h2 id="username">–ó–∞–≥—Ä—É–∑–∫–∞...</h2>
            <p class="balance">–ë–∞–ª–∞–Ω—Å: <span id="balance">0</span> ‚≠ê</p>
            
            <div class="profile-stats">
                <div class="stat-item">
                    <div class="stat-value" id="games-played">0</div>
                    <div class="stat-label">–ò–≥—Ä —Å—ã–≥—Ä–∞–Ω–æ</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="wins">0</div>
                    <div class="stat-label">–ü–æ–±–µ–¥</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="profit">0</div>
                    <div class="stat-label">–ü—Ä–∏–±—ã–ª—å</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Firebase —Å –≤–∞—à–∏–º–∏ –¥–∞–Ω–Ω—ã–º–∏
        const firebaseConfig = {
            apiKey: "rfIdLaULMIe2uo0h3pygEj3lNjAUWrkEOgsyhSD1nE8",
            databaseURL: "https://stars-207f2-default-rtdb.firebaseio.com"
        };

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        // –û—Å–Ω–æ–≤–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã
        const elements = {
            loginScreen: document.getElementById('loginScreen'),
            loginBtn: document.getElementById('loginBtn'),
            profileContainer: document.getElementById('profileContainer'),
            avatar: document.getElementById('avatar'),
            username: document.getElementById('username'),
            balance: document.getElementById('balance'),
            gamesPlayed: document.getElementById('games-played'),
            wins: document.getElementById('wins'),
            profit: document.getElementById('profit')
        };

        // –î–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–≤—Å–µ –∑–Ω–∞—á–µ–Ω–∏—è 0 –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
        let userData = {
            userId: null,
            name: "–ì–æ—Å—Ç—å",
            avatar: "https://via.placeholder.com/150/333333/ffffff?text=USER",
            balance: 0,
            gamesPlayed: 0,
            wins: 0,
            profit: 0,
            registrationDate: new Date().toISOString()
        };

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        document.addEventListener('DOMContentLoaded', function() {
            createStars();
            elements.loginScreen.style.display = 'flex';
            elements.profileContainer.style.display = 'none';
            elements.loginBtn.addEventListener('click', handleLogin);
        });

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—Ö–æ–¥–∞ —á–µ—Ä–µ–∑ Telegram
        function handleLogin() {
            if (window.Telegram?.WebApp?.initDataUnsafe?.user) {
                const tgUser = Telegram.WebApp.initDataUnsafe.user;
                userData.userId = tgUser.id.toString();
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –±–∞–∑–µ
                database.ref('users/' + userData.userId).once('value').then(snapshot => {
                    if (snapshot.exists()) {
                        // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –¥–∞–Ω–Ω—ã–µ
                        const dbData = snapshot.val();
                        userData = {
                            ...userData,
                            ...dbData,
                            name: dbData.name || tgUser.username || 
                                 `${tgUser.first_name || ''} ${tgUser.last_name || ''}`.trim() || 
                                 "–ö–æ—Å–º–æ–Ω–∞–≤—Ç",
                            avatar: dbData.avatar || tgUser.photo_url || 
                                  `https://via.placeholder.com/150/6a5acd/ffffff?text=${userData.name.charAt(0)}`
                        };
                    } else {
                        // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–π –ø—Ä–æ—Ñ–∏–ª—å —Å –Ω—É–ª–µ–≤—ã–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏
                        userData.name = tgUser.username || 
                                      `${tgUser.first_name || ''} ${tgUser.last_name || ''}`.trim() || 
                                      "–ö–æ—Å–º–æ–Ω–∞–≤—Ç";
                        userData.avatar = tgUser.photo_url || 
                                        `https://via.placeholder.com/150/6a5acd/ffffff?text=${userData.name.charAt(0)}`;
                        
                        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –Ω–æ–≤—ã–π –ø—Ä–æ—Ñ–∏–ª—å
                        database.ref('users/' + userData.userId).set(userData);
                    }
                    
                    showProfile();
                    Telegram.WebApp.expand();
                });
            } else {
                alert("–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –æ—Ç–∫—Ä–æ–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —á–µ—Ä–µ–∑ Telegram");
            }
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª—å
        function showProfile() {
            elements.loginScreen.style.display = 'none';
            elements.profileContainer.style.display = 'block';
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
            elements.avatar.src = userData.avatar;
            elements.username.textContent = userData.name;
            elements.balance.textContent = userData.balance;
            elements.gamesPlayed.textContent = userData.gamesPlayed;
            elements.wins.textContent = userData.wins;
            elements.profit.textContent = userData.profit;
        }

        // –û–±–Ω–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –≤ Firebase
        function updateUserData() {
            if (userData.userId) {
                database.ref('users/' + userData.userId).update({
                    balance: userData.balance,
                    gamesPlayed: userData.gamesPlayed,
                    wins: userData.wins,
                    profit: userData.profit
                });
            }
        }

        // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö (–ø—Ä–∏–º–µ—Ä—ã)
        function addBalance(amount) {
            userData.balance += amount;
            if (amount > 0) {
                userData.profit += amount;
            }
            updateUserData();
            showProfile();
        }

        function addGame() {
            userData.gamesPlayed += 1;
            updateUserData();
            showProfile();
        }

        function addWin() {
            userData.wins += 1;
            userData.balance += 100; // –ù–∞–≥—Ä–∞–¥–∞ –∑–∞ –ø–æ–±–µ–¥—É
            userData.profit += 100;
            updateUserData();
            showProfile();
        }

        // –û—Å—Ç–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ (–∑–≤–µ–∑–¥—ã, –º–µ–Ω—é –∏ —Ç.–¥.) –æ—Å—Ç–∞—é—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π
        function createStars() {
            const container = document.getElementById('stars-container');
            const starCount = Math.floor(window.innerWidth / 3);
            
            for (let i = 0; i < starCount; i++) {
                const star = document.createElement('div');
                star.className = 'star';
                
                const size = Math.random() * 3;
                const duration = 2 + Math.random() * 8;
                const delay = Math.random() * 5;
                
                star.style.left = `${Math.random() * 100}%`;
                star.style.top = `${Math.random() * 100}%`;
                star.style.width = `${size}px`;
                star.style.height = `${size}px`;
                star.style.animationDuration = `${duration}s`;
                star.style.animationDelay = `${delay}s`;
                star.style.opacity = Math.random();
                
                container.appendChild(star);
                
                star.addEventListener('animationend', () => {
                    star.remove();
                    createStar();
                });
            }
        }

        function createStar() {
            const container = document.getElementById('stars-container');
            const star = document.createElement('div');
            star.className = 'star';
            
            const size = Math.random() * 3;
            const duration = 2 + Math.random() * 8;
            
            star.style.left = `${Math.random() * 100}%`;
            star.style.top = `-10px`;
            star.style.width = `${size}px`;
            star.style.height = `${size}px`;
            star.style.animationDuration = `${duration}s`;
            star.style.opacity = Math.random();
            
            container.appendChild(star);
            
            star.addEventListener('animationend', () => {
                star.remove();
            });
        }

        function toggleMenu() {
            const menu = document.getElementById('menu');
            menu.style.display = menu.style.display === 'flex' ? 'none' : 'flex';
        }

        function openWithdraw() {
            alert('–§—É–Ω–∫—Ü–∏—è –≤—ã–≤–æ–¥–∞ —Å—Ä–µ–¥—Å—Ç–≤ –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–∞ –≤ —Å–ª–µ–¥—É—é—â–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏');
        }

        function openDeposit() {
            alert('–§—É–Ω–∫—Ü–∏—è –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è –±–∞–ª–∞–Ω—Å–∞ –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–∞ –≤ —Å–ª–µ–¥—É—é—â–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏');
        }

        function openSupport() {
            alert('–°–≤—è–∂–∏—Ç–µ—Å—å —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π —á–µ—Ä–µ–∑ Telegram: @support');
        }

        function openHistory() {
            alert(`–ò—Å—Ç–æ—Ä–∏—è –∏–≥—Ä:
–ò–≥—Ä —Å—ã–≥—Ä–∞–Ω–æ: ${userData.gamesPlayed}
–ü–æ–±–µ–¥: ${userData.wins}
–ü—Ä–∏–±—ã–ª—å: ${userData.profit} ‚≠ê`);
        }
    </script>
</body>
</html>
